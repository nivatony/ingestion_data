{"paragraphs":[{"text":"%pyspark\n## GlueNotebook1 - Parquet Conversion of a CSV dataset.\nprint spark.version\nsys.argv=[\"pq_conversion.py\",\"--JOB_NAME\",\"Parquet_Conversion\",\"--TempDir\",\"s3://neilawsglue/temp\"]","user":"admin","dateUpdated":"2017-10-30T07:07:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2.1.0\n"}]},"apps":[],"jobName":"paragraph_1509128258502_-1698064296","id":"20171027-181738_1744769563","dateCreated":"2017-10-27T18:17:38+0000","dateStarted":"2017-10-30T07:07:20+0000","dateFinished":"2017-10-30T07:07:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:491"},{"text":"%pyspark\n## Glue Job starts here\nimport sys, boto3\nfrom awsglue.context import DynamicFrame,GlueContext\nfrom pyspark.sql.functions import UserDefinedFunction\nfrom pyspark.sql.types import StringType\nfrom awsglue.transforms import ApplyMapping,SelectFields\nfrom awsglue.job import Job\nfrom awsglue.utils import getResolvedOptions\nfrom awsglue.context import GlueContext, DynamicFrame\nfrom pyspark.context import SparkContext\n\nargs = getResolvedOptions(sys.argv, ['TempDir','JOB_NAME'])\n\nsc=sc if 'sc' in vars() else SparkContext()\nglueContext = GlueContext(sc)\nspark = glueContext.spark_session\njob = Job(glueContext)\njob.init(args['JOB_NAME'], args)","user":"admin","dateUpdated":"2017-10-30T07:07:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509128265947_-452232033","id":"20171027-181745_1728881691","dateCreated":"2017-10-27T18:17:45+0000","dateStarted":"2017-10-30T07:07:20+0000","dateFinished":"2017-10-30T07:07:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:492"},{"text":"%pyspark\n### *** CHANGE THESE VARIABLES *** ###\nregion='us-east-1'\nglue_endpoint_url=\"https://glue.us-east-1.amazonaws.com\"\n\n## Replace with values obtained after crawling \"s3://neilawstemp/dataset228\"\nsource_tablename=\"nyc_dataset228\"\nsource_db=\"gluesamples\"\n\n## Specify a writable S3 location\ns3_output_location=\"s3://neilawstemp/dataset230\"","user":"admin","dateUpdated":"2017-10-30T07:07:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509311665242_-853807379","id":"20171029-211425_1225548634","dateCreated":"2017-10-29T21:14:25+0000","dateStarted":"2017-10-30T07:07:20+0000","dateFinished":"2017-10-30T07:07:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:493"},{"text":"%pyspark\n\nglue=boto3.client(service_name='glue', region_name=region,\nendpoint_url=glue_endpoint_url)\n \nsource_table=glue.get_table(Name=source_tablename,DatabaseName=source_db)\nsource_s3_location=source_table['Table']['StorageDescriptor']['Location']\nprint source_s3_location","user":"admin","dateUpdated":"2017-10-30T07:07:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"s3://neilawstemp/dataset228/\n"}]},"apps":[],"jobName":"paragraph_1509131086780_-1128610209","id":"20171027-190446_1736959845","dateCreated":"2017-10-27T19:04:46+0000","dateStarted":"2017-10-30T07:07:20+0000","dateFinished":"2017-10-30T07:07:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:494"},{"text":"%pyspark\ndf = spark.read.option(\"header\", \"true\").csv(source_s3_location)\ndf.printSchema()\n## To limit records for the demo\ncsv_df=df.filter(df.yr == '2015').limit(50000)","user":"admin","dateUpdated":"2017-10-30T07:07:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- quarter: string (nullable = true)\n |-- month: string (nullable = true)\n |-- dayofmonth: string (nullable = true)\n |-- dayofweek: string (nullable = true)\n |-- flightdate: string (nullable = true)\n |-- uniquecarrier: string (nullable = true)\n |-- airlineid: string (nullable = true)\n |-- carrier: string (nullable = true)\n |-- tailnum: string (nullable = true)\n |-- flightnum: string (nullable = true)\n |-- originairportid: string (nullable = true)\n |-- originairportseqid: string (nullable = true)\n |-- origincitymarketid: string (nullable = true)\n |-- origin: string (nullable = true)\n |-- origincityname: string (nullable = true)\n |-- originstate: string (nullable = true)\n |-- originstatefips: string (nullable = true)\n |-- originstatename: string (nullable = true)\n |-- originwac: string (nullable = true)\n |-- destairportid: string (nullable = true)\n |-- destairportseqid: string (nullable = true)\n |-- destcitymarketid: string (nullable = true)\n |-- dest: string (nullable = true)\n |-- destcityname: string (nullable = true)\n |-- deststate: string (nullable = true)\n |-- deststatefips: string (nullable = true)\n |-- deststatename: string (nullable = true)\n |-- destwac: string (nullable = true)\n |-- crsdeptime: string (nullable = true)\n |-- deptime: string (nullable = true)\n |-- depdelay: string (nullable = true)\n |-- depdelayminutes: string (nullable = true)\n |-- depdel15: string (nullable = true)\n |-- departuredelaygroups: string (nullable = true)\n |-- deptimeblk: string (nullable = true)\n |-- taxiout: string (nullable = true)\n |-- wheelsoff: string (nullable = true)\n |-- wheelson: string (nullable = true)\n |-- taxiin: string (nullable = true)\n |-- crsarrtime: string (nullable = true)\n |-- arrtime: string (nullable = true)\n |-- arrdelay: string (nullable = true)\n |-- arrdelayminutes: string (nullable = true)\n |-- arrdel15: string (nullable = true)\n |-- arrivaldelaygroups: string (nullable = true)\n |-- arrtimeblk: string (nullable = true)\n |-- cancelled: string (nullable = true)\n |-- cancellationcode: string (nullable = true)\n |-- diverted: string (nullable = true)\n |-- crselapsedtime: string (nullable = true)\n |-- actualelapsedtime: string (nullable = true)\n |-- airtime: string (nullable = true)\n |-- flights: string (nullable = true)\n |-- distance: string (nullable = true)\n |-- distancegroup: string (nullable = true)\n |-- carrierdelay: string (nullable = true)\n |-- weatherdelay: string (nullable = true)\n |-- nasdelay: string (nullable = true)\n |-- securitydelay: string (nullable = true)\n |-- lateaircraftdelay: string (nullable = true)\n |-- firstdeptime: string (nullable = true)\n |-- totaladdgtime: string (nullable = true)\n |-- longestaddgtime: string (nullable = true)\n |-- divairportlandings: string (nullable = true)\n |-- divreacheddest: string (nullable = true)\n |-- divactualelapsedtime: string (nullable = true)\n |-- divarrdelay: string (nullable = true)\n |-- divdistance: string (nullable = true)\n |-- div1airport: string (nullable = true)\n |-- div1airportid: string (nullable = true)\n |-- div1airportseqid: string (nullable = true)\n |-- div1wheelson: string (nullable = true)\n |-- div1totalgtime: string (nullable = true)\n |-- div1longestgtime: string (nullable = true)\n |-- div1wheelsoff: string (nullable = true)\n |-- div1tailnum: string (nullable = true)\n |-- div2airport: string (nullable = true)\n |-- div2airportid: string (nullable = true)\n |-- div2airportseqid: string (nullable = true)\n |-- div2wheelson: string (nullable = true)\n |-- div2totalgtime: string (nullable = true)\n |-- div2longestgtime: string (nullable = true)\n |-- div2wheelsoff: string (nullable = true)\n |-- div2tailnum: string (nullable = true)\n |-- div3airport: string (nullable = true)\n |-- div3airportid: string (nullable = true)\n |-- div3airportseqid: string (nullable = true)\n |-- div3wheelson: string (nullable = true)\n |-- div3totalgtime: string (nullable = true)\n |-- div3longestgtime: string (nullable = true)\n |-- div3wheelsoff: string (nullable = true)\n |-- div3tailnum: string (nullable = true)\n |-- div4airport: string (nullable = true)\n |-- div4airportid: string (nullable = true)\n |-- div4airportseqid: string (nullable = true)\n |-- div4wheelson: string (nullable = true)\n |-- div4totalgtime: string (nullable = true)\n |-- div4longestgtime: string (nullable = true)\n |-- div4wheelsoff: string (nullable = true)\n |-- div4tailnum: string (nullable = true)\n |-- div5airport: string (nullable = true)\n |-- div5airportid: string (nullable = true)\n |-- div5airportseqid: string (nullable = true)\n |-- div5wheelson: string (nullable = true)\n |-- div5totalgtime: string (nullable = true)\n |-- div5longestgtime: string (nullable = true)\n |-- div5wheelsoff: string (nullable = true)\n |-- div5tailnum: string (nullable = true)\n |-- year: string (nullable = true)\n |-- yr: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1509138285720_220420053","id":"20171027-210445_709717098","dateCreated":"2017-10-27T21:04:45+0000","dateStarted":"2017-10-30T07:07:21+0000","dateFinished":"2017-10-30T07:07:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:495"},{"text":"%pyspark\n#Write to Parquet\ncols=['yr']\ncsv_df.repartition(*cols).write.mode(\"append\").partitionBy(cols).parquet(s3_output_location)","user":"admin","dateUpdated":"2017-10-30T07:07:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509138298586_-1576357311","id":"20171027-210458_939773412","dateCreated":"2017-10-27T21:04:58+0000","dateStarted":"2017-10-30T07:07:21+0000","dateFinished":"2017-10-30T07:08:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:496"},{"text":"%pyspark\njob.commit()\n## Glue Job ends here","user":"admin","dateUpdated":"2017-10-30T07:07:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509311485022_-1343637057","id":"20171029-211125_370734697","dateCreated":"2017-10-29T21:11:25+0000","dateStarted":"2017-10-30T07:07:32+0000","dateFinished":"2017-10-30T07:08:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:497"},{"text":"%pyspark\n## Validation\npq_df=spark.read.parquet(s3_output_location)\nprint \"Records:\"+str(pq_df.count())\npq_df.printSchema()","user":"admin","dateUpdated":"2017-10-30T07:07:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Records:50000\nroot\n |-- quarter: string (nullable = true)\n |-- month: string (nullable = true)\n |-- dayofmonth: string (nullable = true)\n |-- dayofweek: string (nullable = true)\n |-- flightdate: string (nullable = true)\n |-- uniquecarrier: string (nullable = true)\n |-- airlineid: string (nullable = true)\n |-- carrier: string (nullable = true)\n |-- tailnum: string (nullable = true)\n |-- flightnum: string (nullable = true)\n |-- originairportid: string (nullable = true)\n |-- originairportseqid: string (nullable = true)\n |-- origincitymarketid: string (nullable = true)\n |-- origin: string (nullable = true)\n |-- origincityname: string (nullable = true)\n |-- originstate: string (nullable = true)\n |-- originstatefips: string (nullable = true)\n |-- originstatename: string (nullable = true)\n |-- originwac: string (nullable = true)\n |-- destairportid: string (nullable = true)\n |-- destairportseqid: string (nullable = true)\n |-- destcitymarketid: string (nullable = true)\n |-- dest: string (nullable = true)\n |-- destcityname: string (nullable = true)\n |-- deststate: string (nullable = true)\n |-- deststatefips: string (nullable = true)\n |-- deststatename: string (nullable = true)\n |-- destwac: string (nullable = true)\n |-- crsdeptime: string (nullable = true)\n |-- deptime: string (nullable = true)\n |-- depdelay: string (nullable = true)\n |-- depdelayminutes: string (nullable = true)\n |-- depdel15: string (nullable = true)\n |-- departuredelaygroups: string (nullable = true)\n |-- deptimeblk: string (nullable = true)\n |-- taxiout: string (nullable = true)\n |-- wheelsoff: string (nullable = true)\n |-- wheelson: string (nullable = true)\n |-- taxiin: string (nullable = true)\n |-- crsarrtime: string (nullable = true)\n |-- arrtime: string (nullable = true)\n |-- arrdelay: string (nullable = true)\n |-- arrdelayminutes: string (nullable = true)\n |-- arrdel15: string (nullable = true)\n |-- arrivaldelaygroups: string (nullable = true)\n |-- arrtimeblk: string (nullable = true)\n |-- cancelled: string (nullable = true)\n |-- cancellationcode: string (nullable = true)\n |-- diverted: string (nullable = true)\n |-- crselapsedtime: string (nullable = true)\n |-- actualelapsedtime: string (nullable = true)\n |-- airtime: string (nullable = true)\n |-- flights: string (nullable = true)\n |-- distance: string (nullable = true)\n |-- distancegroup: string (nullable = true)\n |-- carrierdelay: string (nullable = true)\n |-- weatherdelay: string (nullable = true)\n |-- nasdelay: string (nullable = true)\n |-- securitydelay: string (nullable = true)\n |-- lateaircraftdelay: string (nullable = true)\n |-- firstdeptime: string (nullable = true)\n |-- totaladdgtime: string (nullable = true)\n |-- longestaddgtime: string (nullable = true)\n |-- divairportlandings: string (nullable = true)\n |-- divreacheddest: string (nullable = true)\n |-- divactualelapsedtime: string (nullable = true)\n |-- divarrdelay: string (nullable = true)\n |-- divdistance: string (nullable = true)\n |-- div1airport: string (nullable = true)\n |-- div1airportid: string (nullable = true)\n |-- div1airportseqid: string (nullable = true)\n |-- div1wheelson: string (nullable = true)\n |-- div1totalgtime: string (nullable = true)\n |-- div1longestgtime: string (nullable = true)\n |-- div1wheelsoff: string (nullable = true)\n |-- div1tailnum: string (nullable = true)\n |-- div2airport: string (nullable = true)\n |-- div2airportid: string (nullable = true)\n |-- div2airportseqid: string (nullable = true)\n |-- div2wheelson: string (nullable = true)\n |-- div2totalgtime: string (nullable = true)\n |-- div2longestgtime: string (nullable = true)\n |-- div2wheelsoff: string (nullable = true)\n |-- div2tailnum: string (nullable = true)\n |-- div3airport: string (nullable = true)\n |-- div3airportid: string (nullable = true)\n |-- div3airportseqid: string (nullable = true)\n |-- div3wheelson: string (nullable = true)\n |-- div3totalgtime: string (nullable = true)\n |-- div3longestgtime: string (nullable = true)\n |-- div3wheelsoff: string (nullable = true)\n |-- div3tailnum: string (nullable = true)\n |-- div4airport: string (nullable = true)\n |-- div4airportid: string (nullable = true)\n |-- div4airportseqid: string (nullable = true)\n |-- div4wheelson: string (nullable = true)\n |-- div4totalgtime: string (nullable = true)\n |-- div4longestgtime: string (nullable = true)\n |-- div4wheelsoff: string (nullable = true)\n |-- div4tailnum: string (nullable = true)\n |-- div5airport: string (nullable = true)\n |-- div5airportid: string (nullable = true)\n |-- div5airportseqid: string (nullable = true)\n |-- div5wheelson: string (nullable = true)\n |-- div5totalgtime: string (nullable = true)\n |-- div5longestgtime: string (nullable = true)\n |-- div5wheelsoff: string (nullable = true)\n |-- div5tailnum: string (nullable = true)\n |-- year: string (nullable = true)\n |-- yr: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1509312591588_-1699268526","id":"20171029-212951_78592860","dateCreated":"2017-10-29T21:29:51+0000","dateStarted":"2017-10-30T07:08:00+0000","dateFinished":"2017-10-30T07:08:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:498"},{"text":"%pyspark\n","user":"admin","dateUpdated":"2017-10-30T07:07:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1509313060046_561001567","id":"20171029-213740_1689719219","dateCreated":"2017-10-29T21:37:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:499"}],"name":"GlueNotebook1-ParquetConversion","id":"2CYQMH657","angularObjects":{"2CRE5X63N:shared_process":[],"2CQZ9JC8F:shared_process":[],"2CNAPD13W:shared_process":[],"2CQ1X8PFU:shared_process":[],"2CNFC7TNE:shared_process":[],"2CMQ2EHTE:shared_process":[],"2CQUCJVJA:shared_process":[],"2CQY3SUDK:shared_process":[],"2CNA37GFQ:shared_process":[],"2CRC324G8:shared_process":[],"2CPH9H73W:shared_process":[],"2CR2XFEE3:shared_process":[],"2CQ9YVF7W:shared_process":[],"2CP1P36EU:shared_process":[],"2CMR9MKCE:shared_process":[],"2CR2YZBFW:shared_process":[],"2CPJK4U6W:shared_process":[],"2CR2Z9UR2:shared_process":[],"2CPQWHWM3:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}